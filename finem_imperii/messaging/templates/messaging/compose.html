{% extends "messaging/base.html" %}

{% block messaging_content %}

    <form class="form-horizontal" role="form" method="post">
        {% csrf_token %}
        <div class="col-lg-5">
            <legend>Message body</legend>
            <div class="form-group">
                <textarea class="form-control"
                          name="message_body"
                          rows="20"
                          id="message_body"
                          placeholder="Enter your text here."
                          maxlength="10000"
                ></textarea>
            </div>

            <button type="submit" class="btn btn-primary pull-right">Send</button>
        </div>
        <div class="col-lg-6 col-lg-offset-1">
            <legend>Recipients by geography</legend>

            <div class="form-group">
                <input type="checkbox" name="receiver" id="receiver_settlement">
                <label for="receiver_settlement">Everyone at {{ request.hero.location }} (local settlement)</label>
                <br>
                <input type="checkbox" name="receiver" id="receiver_region">
                <label for="receiver_region">Everyone at {{ request.hero.location.tile }} (local region)</label>
            </div>

            <legend>Recipients by politics</legend>
            <div class="form-group">
                {% if request.hero.oath_sworn_to %}
                    <input type="checkbox" name="receiver" id="receiver_liege">
                    <label for="receiver_liege">Your Liege ({{ request.hero.oath_sworn_to.get_html_link|safe }}, {{ request.hero.oath_sworn_to.get_position_occupier }})</label>
                    <br>
                {% endif %}
                {% for organization in request.hero.organization_set.all %}
                    {% if not organization.is_position %}
                        <input type="checkbox" name="receiver" id="receiver_organization_{{ organization.id }}">
                        <label for="receiver_organization_{{ organization.id }}">Everyone in {{ organization.get_html_link|safe }}</label>
                        <br>

                        {% if organization.leader %}
                            <input type="checkbox" name="receiver" id="receiver_organization_{{ organization.leader.id }}">
                            <label for="receiver_organization_{{ organization.id }}">{{ organization.leader.get_html_link|safe }}, leader of {{ organization.get_html_link|safe }}</label>
                            <br>
                        {% endif %}
                        {% if organization.owner %}
                            <input type="checkbox" name="receiver" id="receiver_organization_{{ organization.owner.id }}">
                            <label for="receiver_organization_{{ organization.id }}">{{ organization.owner.get_html_link|safe }}, owner of {{ organization.get_html_link|safe }}</label>
                            <br>
                        {% endif %}

                    {% endif %}
                {% endfor %}
            </div>

            <legend>Characters</legend>
            <div class="form-group">
                {% for relationship in request.hero.messagerelationship_set.all %}
                {% empty %}
                    None available. To add characters here, visit a charachter's page.
                {% endfor %}
            </div>
        </div>
    </form>

{% endblock %}
