{% extends "base/base.html" %}

{% block content %}

    <h1 class="page-header">{{ organization }}</h1>

    <div class="row">
        <div class="col-sm-9">
            <table class="table table-striped table-hover">
                <tbody>
                    <tr>
                        <td></td>
                        <td>
                            {{ organization.name }}
                            {% if organization.violence_monopoly %}
                                <br><b>Sovereign</b>
                            {% endif %}
                            {% if organization.owner %}
                                <br>Owned by <a href="{{ organization.owner.get_absolute_url }}">
                                    {{ organization.owner }}
                                </a>
                            {% endif %}
                            {% if organization.leader %}
                                <br>Leaded by <a href="{{ organization.leader.get_absolute_url }}">
                                    {{ organization.leader }}
                                </a>
                            {% endif %}



                            {% if organization.leaded_organizations.all %}
                                <br>Leader of
                                {% for leaded_orga in organization.leaded_organizations.all %}
                                    <a href="{{ leaded_orga.get_absolute_url }}">
                                        {{ leaded_orga }}
                                    </a>
                                    {% if not forloop.last %},{% endif %}
                                {% endfor %}
                            {% endif %}

                            {% if organization.owned_organizations.all %}
                                <br>Owner of
                                    {% for owned_orga in organization.owned_organizations.all %}
                                        <a href="{{ owned_orga.get_absolute_url }}">
                                            {{ owned_orga }}
                                        </a>
                                        {% if not forloop.last %},{% endif %}
                                    {% endfor %}
                            {% endif %}

                        </td>
                    </tr>
                    <tr>
                        <td>Description</td>
                        <td>{{ organization.description }}</td>
                    </tr>
                    <tr>
                        {% if organization.is_position %}
                            <td>Position ocuppied by ({{ organization.membership_type }})</td>
                        {% else %}
                            <td>Members ({{ organization.membership_type }})</td>
                        {% endif %}
                        <td>
                            {% if organization.membership_type == 'character' and organization.character_members.all %}
                                {% for char_member in organization.character_members.all %}
                                    <a href="{{ char_member.get_absolute_url }}">
                                        {{ char_member }}</a>
                                    {% if not forloop.last %},{% endif %}
                                {% endfor %}
                            {% elif organization.membership_type == 'organization' and organization.organization_members.all %}
                                {% for org_member in organization.organization_members.all %}
                                    <a href="{{ org_member.get_absolute_url }}">
                                        {{ org_member }}</a>
                                    {% if not forloop.last %},{% endif %}
                                {% endfor %}
                            {% else %}
                                Vacant
                            {% endif %}
                        </td>
                    </tr>

                </tbody>
            </table>
        </div>

        <div class="col-sm-3">
            <h4>Actions</h4>
            dissolve
            craete sub
            leave / step out

            {% if organization.policydocument_set.all %}
                <h4>Documents</h4>
                <ul>
                    {% for document in organization.policydocument_set.all %}
                        {% if not document.parent %}{% if document.public or hero_is_member %}
                            {% include 'organization/document_tree_inc.html' with document=document show_private=hero_is_member %}
                        {% endif %}{% endif %}
                    {% endfor %}
                </ul>
            {% endif %}
            <a class="btn btn-default" href="{% url 'organization:documents' organization.id %}">Documents</a>
        </div>

        <div class="col-sm-12">
            {% if organization.get_all_controlled_tiles %}
                <h4>Regions</h4>
                <ul>
                    {% for tile in organization.get_all_controlled_tiles %}
                        <li>
                            <a href="{{ tile.get_asbolute_url }}">{{ tile }}</a>
                            {% if tile.controlled_by != organization %}
                                (controlled by <a href="{{ tile.controlled_by.get_absolute_url }}">
                                {{ tile.controlled_by }}</a>
                            {% endif %}
                        </li>
                    {% empty %}
                        <li>None</li>
                    {% endfor %}
                </ul>
            {% endif %}

            <h4>Powers</h4>
            <ul>
                {% for capability in organization.capability_set.all %}
                    <li>
                        <b>{{ capability.get_type_display|capfirst }}</b>
                        in <a href="{{ capability.applying_to.get_absolute_url }}">{{ capability.applying_to }}</a>
                        {% if capability.stemming_from %}
                            (delegated by <a href="{{ capability.stemming_from.organization.get_absolute_url }}">
                            {{ capability.stemming_from.organization }}</a>
                        {% endif %}
                    </li>
                {% empty %}
                    <li>None</li>
                {% endfor %}
            </ul>

            <h4>Powers</h4>
            <ul>
                {% for capability in organization.capabilities_to_this.all %}
                    <li>
                        <a href="{{ capability.organization.get_absolute_url }}">{{ capability.organization }}</a>
                        can <b>{{ capability.get_type_display }}</b>
                        {% if capability.stemming_from %}
                            (delegated by <a href="{{ capability.stemming_from.organization.get_absolute_url }}">
                            {{ capability.stemming_from.organization }}</a>
                        {% endif %}
                    </li>
                {% empty %}
                    <li>None</li>
                {% endfor %}
            </ul>
        </div>

    </div>


{% endblock %}
